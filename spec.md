# Gantty 仕様書

## 概要

Ganttyは、WBS（作業分解構造）とガントチャートを統合したプロジェクト管理ツールです。チームでのプロジェクト計画・進捗管理を支援します。

## 技術スタック

- **フレームワーク**: Tauri v2
- **フロントエンド**: React + TypeScript
- **UIライブラリ**: 未定（shadcn/ui等を推奨）
- **状態管理**: 未定（Zustand等を推奨）
- **ファイル形式**: JSON（`.gantty`拡張子）

## 機能一覧

### Phase 1: MVP（WBS + ガントチャート基本機能）

#### ビュー切り替え
同一のタスクデータを複数の視点から閲覧・操作できる。ビュー間はリアルタイムに同期される。

- [ ] **ガントビュー**（デフォルト）: WBS一覧 + ガントチャートの2ペイン表示
- [ ] **リストビュー**: タスクをツリー構造で一覧表示（詳細情報の確認・一括編集向け）
- [ ] **カンバンビュー**: ステータス別にタスクをカード形式で表示
- [ ] **ネットワークビュー**: タスク間の依存関係をノード・エッジ形式で視覚化
- [ ] ビュー切り替えボタン（ツールバーまたはタブ）
- [ ] 各ビューの表示設定の保持

#### タスク詳細パネル
全ビュー共通で、タスクの詳細情報を編集できるパネルを提供する。

- [ ] 全ビュー（ガント/リスト/カンバン/ネットワーク）からタスク詳細パネルを開く
- [ ] タスクをクリックまたはダブルクリックで詳細パネルを表示
- [ ] パネル内で全属性（名前、日程、進捗、責任者、ボール等）を編集可能

#### WBS機能
- [ ] 階層構造のタスク管理（親子関係）
  - 階層の深さ: 無制限（ただし実用上は5階層程度を推奨）
  - 親タスクの自動計算ルール:
    - **開始日**: 子タスクの最も早い開始日
    - **終了日**: 子タスクの最も遅い終了日
    - **進捗率**: 子タスクの工数加重平均（工数未設定時は単純平均）
    - **工数**: 子タスクの工数合計
  - 親タスクの日程・進捗は自動計算され、直接編集不可
- [ ] タスクの基本属性
  - タスク名
  - 説明（Markdown対応）
  - 開始日・終了日
  - 工数（予定/実績） ※単位: 時間/人日/ポイントから選択可能
  - 進捗率（0-100%）
  - ステータス
  - 責任者（Responsible）
  - ボール（Ball）
- [ ] タスクの追加・編集・削除
- [ ] サブタスク追加時のインライン入力
  - 親タスクの直下に入力フィールドを表示
  - 入力フィールドは親タスクのインデントに合わせて表示
  - Enter で確定、Escape でキャンセル

#### 責任者とボールの二元管理
タスクの「責任」と「実行」の所在を明確にするため、以下の2つの属性を持つ。

- **責任者（Responsible）**: タスク完了の最終責任を負う人物
  - タスクの品質担保、期限管理、完了承認を行う
  - タスクのライフサイクルを通じて基本的に固定
- **ボール（Ball）**: 現在アクションを起こすべき人物
  - タスクを進めるために「今動くべき人」を示す
  - 作業完了後、次の工程担当者へボールをパスする
  - 「誰のところでタスクが止まっているか」を可視化

この仕組みにより、タスクの滞留場所（ボトルネック）が明確になり、プロジェクトの遅延防止に貢献する。

- [ ] ボールのパス（担当者間でのボール移動）
- [ ] ボール保持者によるタスクフィルタリング
- [ ] タスクの並び替え（ドラッグ&ドロップ）
- [ ] タスクの折りたたみ/展開

#### ガントチャート表示
- [ ] 日/週/月の表示スケール切り替え
- [ ] タスクバーの表示
- [ ] 進捗率の視覚的表示（バー内の塗りつぶし）
- [ ] 今日の日付ライン表示
- [ ] 横スクロール・縦スクロール対応

#### ガントチャート編集
- [ ] バーのドラッグ&ドロップによる日程変更
  - バー全体をドラッグして開始日・終了日を同時に移動
  - 所要日数を維持したまま移動
- [ ] バーの端をドラッグして期間変更
  - 左端をドラッグして開始日を変更
  - 右端をドラッグして終了日を変更
  - ドラッグ中は変更後の日付をツールチップで表示
  - リサイズハンドルを視覚的に表示（ホバー時）

#### カンバンビュー
- [ ] ステータス管理
  - デフォルトステータス: 未対応、処理中、レビュー待ち、完了
  - ステータスの名称・色のカスタマイズ
  - ステータスの追加・削除・並び替え
- [ ] タスクカードの表示
  - タスク名、責任者、ボール、期限を表示
  - 進捗率のプログレスバー表示
- [ ] ドラッグ&ドロップによるステータス変更
- [ ] カード内での並び替え

#### リストビュー
- [ ] タスクをツリー構造で一覧表示
- [ ] インデントによる親子関係の視覚的表現
- [ ] 表示列のカスタマイズ（表示/非表示、順序）
- [ ] 列ごとのソート機能
- [ ] インライン編集
- [ ] ドラッグ&ドロップによるタスクの並び替え・階層変更
  - ドラッグ中にドロップ先のプレビュー表示
  - ドロップ位置インジケーター（上/下/子として追加）
  - 移動後の階層構造をリアルタイムでプレビュー
  - 循環参照となる移動は禁止

#### ネットワークビュー
タスク間の依存関係をノードとエッジで視覚化し、直感的に編集できるビュー。

- [ ] タスクをノード（カード形式）で表示
  - タスク名、ステータス、進捗率を表示
  - ノードの色はステータスに連動
- [ ] 依存関係をエッジ（矢印線）で表示
  - 依存タイプ（FS/SS/FF/SF）を線のスタイルで区別
  - ラグ/リードタイムを線上にラベル表示
- [ ] ノードのドラッグ移動
  - ノードを自由に配置可能
  - 配置位置の永続化
- [ ] エッジの作成
  - ノード間をドラッグして依存関係を作成
  - 作成時に依存タイプを選択
- [ ] エッジの編集・削除
  - エッジをクリックして選択
  - 選択したエッジの依存タイプ・ラグを編集
  - Delete キーまたはコンテキストメニューで削除
- [ ] ノードの自動レイアウト
  - 依存関係に基づく左から右への配置
  - 手動配置とのハイブリッド対応

#### メンバー管理（簡易リソースマスタ）
責任者・ボールに設定するメンバーを管理する。

- [ ] メンバーの登録・編集・削除
- [ ] メンバー属性
  - 名前（必須）
  - 表示色
- [ ] タスク作成時のデフォルト: 作成者が責任者かつボール保持者

#### ファイル操作
- [ ] 新規プロジェクト作成
- [ ] プロジェクトの保存（`.gantty`形式）
- [ ] プロジェクトの読み込み
- [ ] 自動保存機能
  - 最後の変更から30秒後に自動保存
  - 保存先: 元のファイルを上書き
  - 設定で無効化可能

### Phase 2: 依存関係・マイルストーン・操作性向上

#### 検索・フィルタ機能
- [ ] タスク名での検索
- [ ] フィルタ条件
  - ステータス
  - 責任者
  - ボール保持者
  - 期限（今日、今週、遅延中など）
- [ ] フィルタ条件の保存

#### Undo/Redo機能
- [ ] 操作履歴の管理
- [ ] 元に戻す（Ctrl/Cmd + Z）
- [ ] やり直し（Ctrl/Cmd + Shift + Z）

#### キーボードショートカット
- [ ] 基本操作
  - `Ctrl/Cmd + S`: 保存
  - `Ctrl/Cmd + N`: 新規タスク
  - `Delete`: タスク削除
  - `Tab`: インデント
  - `Shift + Tab`: アウトデント
  - `↑/↓`: タスク間移動
  - `Enter`: タスク編集
  - `Escape`: 編集キャンセル
- [ ] ビュー切り替え
  - `Ctrl/Cmd + 1`: ガントビュー
  - `Ctrl/Cmd + 2`: リストビュー
  - `Ctrl/Cmd + 3`: カンバンビュー
  - `Ctrl/Cmd + 4`: ネットワークビュー

#### 依存関係
- [ ] 依存関係の種類
  - FS（終了-開始）: 前タスク終了後に開始
  - SS（開始-開始）: 前タスク開始と同時に開始
  - FF（終了-終了）: 前タスク終了と同時に終了
  - SF（開始-終了）: 前タスク開始後に終了
- [ ] ラグ/リードタイム設定（+/-日数）
- [ ] 依存関係の矢印表示
- [ ] 依存関係に基づく日程自動調整

#### マイルストーン
- [ ] マイルストーンの作成（期間0日のタスク）
- [ ] マイルストーン専用アイコン表示（◆）
- [ ] マイルストーンへの依存関係設定

#### クリティカルパス
- [ ] クリティカルパスの自動計算
- [ ] クリティカルパス上のタスクをハイライト表示

### Phase 3: リソース管理（拡張）

#### リソースマスタ拡張
Phase 1のメンバー管理を拡張し、より詳細なリソース管理を行う。

- [ ] リソース属性の拡張
  - 稼働率（デフォルト100%）

#### リソース割り当て
- [ ] タスクへのリソース割り当て（複数可）
- [ ] 割り当て率の設定（例: 50%）

#### 負荷表示
- [ ] リソース別の負荷グラフ表示
- [ ] 過負荷（100%超）の警告表示

### Phase 4: カレンダー・カスタムフィールド

#### カレンダー設定
- [ ] 非稼働日の設定（土日デフォルト）
- [ ] 祝日・休日の個別設定
- [ ] 非稼働日をグレー表示
- [ ] 工数計算に非稼働日を反映

#### カスタムフィールド
- [ ] カスタムフィールドの追加
  - テキスト
  - 数値
  - 日付
  - 選択肢（ドロップダウン）
  - チェックボックス
- [ ] WBS一覧での表示列カスタマイズ

#### タグ機能
- [ ] タグの作成（名前・色）
- [ ] タスクへのタグ付け（複数可）
- [ ] タグによるフィルタリング

### Phase 5: エクスポート

#### PDF出力
- [ ] ガントチャートのPDF出力
- [ ] 用紙サイズ・向きの選択
- [ ] 出力範囲の指定（日付範囲）

#### Excel/CSV出力
- [ ] WBSデータのExcel出力
- [ ] WBSデータのCSV出力
- [ ] 出力列の選択

## データ構造

### プロジェクトファイル（.gantty）

```json
{
  "version": "1.0",
  "project": {
    "name": "プロジェクト名",
    "createdAt": "2025-01-01T00:00:00Z",
    "updatedAt": "2025-01-01T00:00:00Z"
  },
  "settings": {
    "workingDays": [1, 2, 3, 4, 5],
    "holidays": ["2025-01-01", "2025-01-13"],
    "defaultView": "gantt",
    "effortUnit": "hours",
    "autoSaveEnabled": true,
    "autoSaveIntervalSeconds": 30
  },
  "statuses": [
    {
      "id": "uuid",
      "name": "未対応",
      "color": "#6B7280",
      "order": 0
    },
    {
      "id": "uuid",
      "name": "処理中",
      "color": "#3B82F6",
      "order": 1
    },
    {
      "id": "uuid",
      "name": "レビュー待ち",
      "color": "#F59E0B",
      "order": 2
    },
    {
      "id": "uuid",
      "name": "完了",
      "color": "#10B981",
      "order": 3
    }
  ],
  "resources": [
    {
      "id": "uuid",
      "name": "担当者名",
      "color": "#3B82F6",
      "capacity": 100
    }
  ],
  "customFields": [
    {
      "id": "uuid",
      "name": "フィールド名",
      "type": "text|number|date|select|checkbox",
      "options": ["選択肢1", "選択肢2"]
    }
  ],
  "tags": [
    {
      "id": "uuid",
      "name": "タグ名",
      "color": "#EF4444"
    }
  ],
  "tasks": [
    {
      "id": "uuid",
      "parentId": null,
      "name": "タスク名",
      "description": "タスクの詳細説明（Markdown対応）",
      "startDate": "2025-01-01",
      "endDate": "2025-01-05",
      "plannedHours": 40,
      "actualHours": 20,
      "progress": 50,
      "statusId": "uuid",
      "responsibleId": "uuid",
      "ballHolderId": "uuid",
      "isMilestone": false,
      "createdAt": "2025-01-01T00:00:00Z",
      "updatedAt": "2025-01-01T00:00:00Z",
      "resources": [
        {
          "resourceId": "uuid",
          "allocation": 100
        }
      ],
      "dependencies": [
        {
          "predecessorId": "uuid",
          "type": "FS",
          "lag": 0
        }
      ],
      "tags": ["uuid"],
      "customFields": {
        "field-uuid": "値"
      },
      "order": 0
    }
  ]
}
```

## UI構成

### ガントビュー（デフォルト）
```
+----------------------------------------------------------+
|  メニューバー                                              |
+----------------------------------------------------------+
|  ツールバー  [ガント] [リスト] [カンバン] [ネットワーク]      |
+----------------------------------------------------------+
|                    |                                      |
|   WBS一覧          |   ガントチャート                       |
|   （左ペイン）      |   （右ペイン）                         |
|                    |                                      |
|   - タスク1        |   ████████                           |
|     - サブタスク   |      ████                            |
|   - タスク2        |          ██████████                  |
|                    |                                      |
+----------------------------------------------------------+
|  ステータスバー                                            |
+----------------------------------------------------------+
```

### カンバンビュー
```
+----------------------------------------------------------+
|  メニューバー                                              |
+----------------------------------------------------------+
|  ツールバー  [ガント] [リスト] [カンバン] [ネットワーク]      |
+----------------------------------------------------------+
|  未対応     |  処理中     |  レビュー待ち |  完了          |
|  ─────────  |  ─────────  |  ───────────  |  ─────────    |
|  ┌───────┐  |  ┌───────┐  |  ┌───────┐    |  ┌───────┐   |
|  │タスク1│  |  │タスク3│  |  │タスク5│    |  │タスク7│   |
|  │担当:A │  |  │担当:B │  |  │担当:A │    |  │担当:C │   |
|  └───────┘  |  └───────┘  |  └───────┘    |  └───────┘   |
|  ┌───────┐  |  ┌───────┐  |               |  ┌───────┐   |
|  │タスク2│  |  │タスク4│  |               |  │タスク8│   |
|  └───────┘  |  └───────┘  |               |  └───────┘   |
+----------------------------------------------------------+
|  ステータスバー                                            |
+----------------------------------------------------------+
```

### リストビュー
```
+----------------------------------------------------------+
|  メニューバー                                              |
+----------------------------------------------------------+
|  ツールバー  [ガント] [リスト] [カンバン] [ネットワーク]      |
+----------------------------------------------------------+
| タスク名        | 開始日   | 終了日   | 責任者 | ボール   |
| ─────────────── | ──────── | ──────── | ────── | ──────── |
| ▼ タスク1       | 1/1      | 1/5      | 田中   | 佐藤     |
|   └ サブタスク  | 1/2      | 1/3      | 佐藤   | 佐藤     |
| ▶ タスク2       | 1/6      | 1/10     | 鈴木   | 田中     |
| タスク3         | 1/11     | 1/15     | 田中   | 田中     |
+----------------------------------------------------------+
|  ステータスバー                                            |
+----------------------------------------------------------+
```

### ネットワークビュー
```
+----------------------------------------------------------+
|  メニューバー                                              |
+----------------------------------------------------------+
|  ツールバー  [ガント] [リスト] [カンバン] [ネットワーク]      |
+----------------------------------------------------------+
|                                                          |
|    ┌─────────┐         ┌─────────┐         ┌─────────┐   |
|    │ タスク1 │────FS──▶│ タスク3 │────FS──▶│ タスク5 │   |
|    │ 進捗:50%│         │ 進捗:0% │         │ 進捗:0% │   |
|    └─────────┘         └─────────┘         └─────────┘   |
|         │                                       ▲        |
|         │FS                                     │FS      |
|         ▼                                       │        |
|    ┌─────────┐         ┌─────────┐              │        |
|    │ タスク2 │────SS──▶│ タスク4 │──────────────┘        |
|    │ 進捗:30%│         │ 進捗:0% │                       |
|    └─────────┘         └─────────┘                       |
|                                                          |
+----------------------------------------------------------+
|  ステータスバー                                            |
+----------------------------------------------------------+
```

### 画面要素

#### メニューバー
- ファイル（新規、開く、保存、名前を付けて保存、エクスポート、終了）
- 編集（元に戻す、やり直し、カット、コピー、ペースト）
- 表示（ビュー切替、スケール切替、リソース負荷表示）
- プロジェクト（リソース管理、カレンダー設定、カスタムフィールド設定、ステータス設定）

#### ツールバー
- ビュー切り替え（ガント/リスト/カンバン/ネットワーク）
- 新規タスク追加
- タスク削除
- インデント/アウトデント
- スケール切替（日/週/月）※ガントビューのみ
- 今日に移動 ※ガントビューのみ
- 依存関係追加モード ※ガントビュー・ネットワークビューのみ
- 自動レイアウト ※ネットワークビューのみ

#### WBS一覧（左ペイン）
- 列: タスク名、開始日、終了日、工数、進捗率、責任者、ボール、（カスタムフィールド）
- 列幅調整可能
- 列の表示/非表示切り替え
- 行の右クリックメニュー

#### ガントチャート（右ペイン）
- タイムスケールヘッダー（2段: 月+日など）
- タスクバー
- 依存関係の矢印
- 今日のライン（赤い縦線）
- 非稼働日の背景色

## 制約事項

- **プラットフォーム**: Windows / macOS / Linux（Tauri対応）
- **言語**: 日本語のみ
- **テーマ**: ライトテーマのみ
- **データ保存**: ローカルファイルのみ（クラウド同期なし）
- **同時編集**: 非対応（ファイル共有は外部ツールで行う）

## 非機能要件

- **パフォーマンス**: 1000タスクでもスムーズに動作
- **ファイルサイズ**: プロジェクトファイルは可能な限り軽量に（1000タスクで約1MB以下を目標）
- **自動保存**: 最後の変更から30秒後に自動保存（設定で無効化可能）

## 仕様の補足

### ステータスと進捗率の関係
- ステータスを「完了」に変更した場合、進捗率は自動的に100%に更新される
- 進捗率を100%に変更しても、ステータスは自動変更されない（手動で変更）

### カンバンビューでの親タスクの扱い
- 親タスク（子タスクを持つタスク）はカンバンビューに表示しない
- リーフタスク（子タスクを持たないタスク）のみがカード表示される

### バリデーションルール
- 終了日は開始日以降でなければならない
- 違反時はエラー表示し、保存を許可しない

## 今後の検討事項

- チーム共有方法（Git連携、ファイル共有フォルダなど）
- ベースライン機能の追加
- 多言語対応
- ダークテーマ対応
- MS Project形式のインポート/エクスポート
